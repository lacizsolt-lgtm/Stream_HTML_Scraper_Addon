name: Deploy to BeamUp
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Install BeamUp CLI
        run: npm install -g beamup-cli

      - name: Configure and Debug Environment
        run: |
          # Létrehozzuk a mappát több lehetséges helyen is (biztos ami biztos)
          mkdir -p ~/.beamup
          mkdir -p ~/.config/beamup
          
          # Beírjuk a konfigot
          echo '${{ secrets.BEAMUP_CONFIG }}' > ~/.beamup/config.json
          echo '${{ secrets.BEAMUP_CONFIG }}' > ~/.beamup-config.json
          
          # DEBUG: Megnézzük a fájlok létezését és méretét (tartalom nélkül!)
          echo "--- DEBUG: Konfigurációs fájlok ellenőrzése ---"
          ls -la ~/.beamup/config.json
          ls -la ~/.beamup-config.json
          
      - name: Deploy to BeamUp (With Force Response)
        run: |
          echo "--- DEBUG: Deploy indítása ---"
          # A 'printf' segítségével sorrendben "beetetjük" a válaszokat, ha a CLI kérdezné:
          # 1. Host neve
          # 2. Felhasználónév
          # A '2>&1' az összes hibaüzenetet a normál kimenetre tereli, hogy lássuk a logban.
          printf "a.baby-beamup.club\nlacizsolt-lgtm\n" | beamup deploy 2>&1
        env:
          BEAMUP_HOST: a.baby-beamup.club
          BEAMUP_USER: lacizsolt-lgtm
